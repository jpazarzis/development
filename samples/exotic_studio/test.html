<!DOCTYPE html>
<html>
<head>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<link rel="stylesheet" href="theme3.css" />
<script type='text/javascript' src='compression_logic.js'></script>

<script>

var MAX_NUMBER_OF_HORSES_PER_RACE = 20;
var full_system = null;

function exists_in_array(list,element){
        return list.indexOf(element) > -1;
}

function remove_from_array(list,element){
    var index  = list.indexOf(element);
    if (index > -1) {
        list.splice(index, 1);
    }
}

function Limitation(){
}

function Group(){
    this.limitations = []

    this.to_html = function to_html(){
        var html = '';
        html += '<button>Add Limitation</button>';
        for(var i = 0; i < this.limitations.length; ++i){
            html += this.limitations[i].to_html()
        }
        return html;
    }
}


function make_full_system(numberOfRaces,maxHorsesPerRace){
    this.numberOfRaces = numberOfRaces;
    this.selections = []
    this.groups = []

    for(var i = 0; i < this.numberOfRaces; ++i){
        var race_selections = []
        for(var j = 0; j < maxHorsesPerRace; ++j){
            race_selections.push( 
                { 
                    horse_number: j+1, 
                    is_selected: false 
                });
        }
        this.selections.push(race_selections)
    }

    this.groups_as_html() = function groups_as_html(){
        var groups_as_html = '';
        for(var i = 0; i < full_system.groups.length; ++i){
            groups_as_html += this.groups[i].to_html();
        }
        return groups_as_html;
    }

    this.selections_per_race = function selections_per_race(race_index){
        return this.selections[race_index].filter(function(s) { return s.is_selected; });
    }

    this.countFullSystem = function countFullSystem(){
        var counter = 1;
        for(var race_index = 0; race_index < this.selections.length; ++race_index){
            counter *= this.selections_per_race(race_index).length;
        }
        return counter;
    }

    this.toggle_selection = function toggle_selection(race_index, horse_index){
        this.selections[race_index][horse_index].is_selected = !this.selections[race_index][horse_index].is_selected;
    }

    this.add_group() = function add_group(){
        var g = new Group();
        this.groups.push(g);
        return g;
    }

    this.remove_group = function remove_group(g){
        remove_from_array(this.groups,g);
    }
}

function show_statistics(){
    var full_system_count = full_system.countFullSystem();
    $("#statusCtrl").html(full_system_count);
    if(full_system_count == 0){
        $("#optionsCtrl").hide();
    } else {
        $("#optionsCtrl").show();
    }
}


function display_full_system(){
    var selections = full_system.selections;
    var table = document.createElement("table");
    for(var i=0; i < selections.length; ++i){
        var row = document.createElement("tr");
        var cell = document.createElement("td");
        cell.appendChild(document.createTextNode(i+1));
        row.appendChild(cell);
        for(var j=0; j < selections[i].length; ++j){
            var cell = document.createElement("td");
            var button = document.createElement("button");
            button.className = "full_system_button";
            button.appendChild(document.createTextNode(selections[i][j].horse_number));
            button.race_index = i;
            button.horse_index = j;
            button.paint_it = function (){
                var si = full_system.selections[this.race_index][this.horse_index];
                this.style.background = si.is_selected ? 'green': 'gray';
            }
            button.onclick = function () { 
                full_system.toggle_selection(this.race_index, this.horse_index);
                this.paint_it();
                show_statistics();
            };
            button.paint_it();
            cell.appendChild(button);
            row.appendChild(cell);
        }
        table.appendChild(row);
    }
    $('#fullSystemCtrl').append(document.createElement("br"));
    $('#fullSystemCtrl').append(table);
    show_statistics();
    $("#groupsCtrl").html(full_system.groups_as_html());
}



$(document).ready(function(){
    full_system = new make_full_system(4,MAX_NUMBER_OF_HORSES_PER_RACE);
    display_full_system();
}
);
</script>

</head>
<body style='width=720px'>


<div class='counter_div'>
</div>

<div id='statusCtrl'>

</div>

<div id='optionsCtrl'>
<button title="add group of limitations" onclick="full_system.add_group();">
<img src="add.jpeg" width="30px" height="30px"  />
</button>
<button title="develop tickets"  onclick="develop_tickets();">
<img src="develop.jpeg" width="30px" height="30px"  />
</button>
</div>


<div id='fullSystemCtrl'>
<span class='title'>Full System</span>
</div>


<div id='groupsCtrl'>
<span class='title'>Groups Of Limitations</span>
</div>

<div id='ticketsCtrl'>
<span class='title'>Tickets</span>
</div>


</body>
 </html>
